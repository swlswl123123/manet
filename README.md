# 相控阵宽带自组网系统

## 工程目录结构

```
├── doc       //相控阵宽带自组织网络总体设计报告
├── Makefile  //自动化编译脚本
├── model     //OPNET仿真模型/脚本/配置
├── README.md //说明文档
└── sim       //OPNET自动化仿真测试脚本/MATLAB性能分析及绘图脚本
```

## 丢包问题

* 注意天线高度和通信距离的关系
* 注意队列MTU大小



## 南京724所反馈意见

### 建议完善内容
序号|完善内容|备注
:--:|:--|:--
2|P12：图中 CONV 模块将 6 字节的 IP 地址转为了 1 字节，是如何实现映射的？IP 是否静态，若使用 DHCP，则如何实现分配。|√
2|P22：图中的“逻辑信道解复用”是如何实现和使用的？
3|P32：需要按 QFI 所分类的业务类型，说明 TM、UM 和 AM 几种传输模式所服务的业务数据对象。
4|P33：如何创建和撤销 RLC 实体，是否在线动态创建，且如何在 FPGA中实例化？
5|P34：提到了 RX_Next_Highesst 等许多参数，但未说明各个参数的实际定义和作用。
6|P35：AM 模式和 UM 模式中的 PDU 接收处理流程建议表述为流程图或其他描述方式。
7|P40、P41：包格式中的 P、SI、SO、SOstart 等多个字段的定义和作用未有明确解说。
8|P52：“OP 节点”在文档内没有明确说明是什么。
9|P54：在第二轮的扫描模式选择中是否仍采用 1/2 概率随机确定。
10|P58：基本时隙和扩展时隙分配都采用了邻居协商自主确定的方式，但在业务负荷超载情况下，高优先级业务如何抢占获得传输信道资源？且在协商过程中，如何解决与 2hop 邻居信道冲突？此部分关系到了整个网络的稳定性和可靠性，需要在设计过程中考虑各种冲突和意外处理。
11|RLC 层添加的 RLC 字段所代表的意义？与后续文档介绍的 RLC 帧格式长度不一致
12|如果多个同类型目的节点相同的上层业务数据，如何处理？
13|希望后续方案能就更换硬件导致配置丢失后，如何自适应的处理？
14|如果广播节点的一个波束内有两个侦听节点，如何处理？
15|P54 的 14 点，以多次时钟偏置换取时间窗口的对准，如果都是无时统节点，分析同步的效率。
16|9.3.2 节第 2 点是否写错了，而且该节只描述了一种情况下的处理方式，未列另一种情况的。
17|P21 中 MAC 层的 HARQ 机制和 RLC 层的 ARQ 机制有何区别？它们是如何配合的？
18|表 1 中的业务划分与 P25 第 9 点提到的四种信息是如何对应的？
19|在 9.2 节给出的时间同步策略中，两个节点时间不一致时如何确定该同步到哪个时间？相隔较远的两个节点开始同步，可能造成两个节点集合同步的时间不一致，如何解决这个问题？
20|虽然网络拓扑不会快速变化，但是链路分配信息有可能快速变化，根据Dijkstra算法计算最短链路在网络规模较大时如何保证高优先级业务的时延？
21| 当新节点加入或旧节点退出网络时如何向全网广播该消息？

## 建议补充内容


序号|补充内容|备注
:--:|:--|:--
1|补充 RRC 章节内容
2|补充信道编码详细实现方法
3|多个子网间的时间同步实现方法以及子网合并融合方法
4|RLC 中 SDU 和 PDU 详细处理过程方法
5|OFDM 前端非线性分析与对应处理方法
6|OFDM 相控阵传输多通道幅相不一致性分析与对应处理方法
7|OFDM 接收端信道估计与均衡方法
8|补充 16QAM 峰均比高的解决方法
9|多速率自适应切换方法
10|全为无时统节点的情况的同步和组网方法
11|CPU 和 FPGA 的数据同步交互方法
12|Conv 模块为以太网 MAC 帧到本方案的协议转换。但没有对拼包/组包的介绍，尤其是其采用 RLC-SDU 的方式，如何拼组包
13|补充说明 PDCP 协议的作用
14|补充四面阵的硬件接入设计


## 工作计划

2019年12月13日前

- [X] 完成链路信息共享机制设计 12月10日 **已完成**
- [X] 完成路由表信息计算与更新机制设计 12月10日 **已完成**
- [x] 完成广播扩散机制设计 12月11日 **已完成**
- [x] 完成基本业务数据传输机制设计 12月12日 **已完成**
- [x] 完成扩展业务时隙分配机制设计 预计12月13日上午
- [x] 完成紧急业务时隙分配机制设计 预计12月13日下午
- [x] 设计仿真方案和评价指标 预计12月13日 晚上
- [x] 改进和完善相关文档描述与配图 预计12月13日 晚上
- [ ] 验证硬件平台传输延时是否满足项目需求 预计12月14日 上午
- [x] 完成RLC模块ARQ机制设计 预计12月15日 上午
- [x] 完成SDAP模块设计 预计12月15日 下午


## 工作日志

时间|人员|内容
:--|:--|:--
2019-10-17|李钊|初始化项目存储库,完成节点模型框架设计
2019-10-18|李钊|简化定向天线建模、ema代码编写、文档整理
2019-10-19|李钊/孙文亮|探讨组网策略
2019-10-21|李钊|天线坐标转换公式推导
2019-10-22|李钊|天线指向模块代码编写
2019-10-23|李钊|修改OPNET天线收发增益计算模型
2019-10-24|吴义辰/常晓华/李钊/孙文亮|1.修复部分问题<br>2.讨论细化组网方案
2019-10-25|李钊|完成预约时隙、数据时隙OPNET框架搭建
2019-10-28|吴义辰/李钊|南京724所对接,详见会议纪要
2019-10-29|李钊/孙文亮|1.完善OPNET时隙中断机制与设计文档一致<br>2.时隙划分部分代码与主分支合并
2019-10-30|李钊|时隙划分与预约改进方案设计
2019-10-31|李钊|时隙划分与预约改进方案设计与文档撰写
2019-11-01|吴义辰/李钊/孙文亮|讨论确定了新方案,详见会议纪要
2019-11-04|李钊|确定总体设计方案大纲及后续工作分工安排
2019-11-05|李钊|链路发现/链路资源分配matlab原理仿真
2019-11-06|李钊|撰写D-TDMA时帧结构一节
2019-11-07|李钊|无时统节点同步算法matlab原理仿真
2019-11-08|李钊|撰写链路发现一节
2019-11-09|李钊|调整了无时统节点时间同步算法

## 2019-11-01会议纪要

1. 改进方案构想基本采纳。
2. 邻居发现阶段按5Mb模式,6Mb最大瞬时数据速率设计以保证该阶段具有较远的探测距离和较低的误码率。
3. 考虑通用时隙组中包含更多短帧的数据时隙。
4. 考虑只有秒脉冲的情况下，天线扫描随机指向问题。
5. 邻居发现阶段新增的短帧中起始扫描方向与原有短帧相反。
6. 11月30日前完成设计报告和仿真验证。任务分工:
   * 李钊:框架搭建
   * 孙文亮:内容补充
   * 吴义辰:审核


## 2019-10-24会议纪要

1. 组网阶段时隙分配方案
   * 每1000ms为一长帧
   * 每50ms为一短帧
   * 每一短帧中前10ms为通信业务占用，后40ms为雷达业务占用

2. 网络维持阶段时隙分配方案
   * 每1000ms为一长帧
   * 每100ms为一短帧
   * 每一短帧中前10ms为通信业务占用，后90ms为雷达业务占用

```
组网阶段:
0     10ms                50ms  60ms                 100ms
|+++++|++++++++++++++++++++|+++++|++++++++++++++++++++|
| NRD |      INVALID       | NRD |      INVALID       |
|+++++|++++++++++++++++++++|+++++|++++++++++++++++++++|

网络维持阶段:
0     10ms                                           100ms
|+++++|+++++++++++++++++++++++++++++++++++++++++++++++|
| NRD |                  INVALID                      |
|+++++|+++++++++++++++++++++++++++++++++++++++++++++++|

```

3. 定向链路发现时间
   
    定义:两个可视距通信的节点互相发现对方所用的最长时间

    最差情况:两个节点均进入网络维持阶段，假设每个长帧中可完成一次全向扫描并假设两个节点工作模式为一收一发，则定向链路发现时间为1000ms。

    节点完成一次全向扫描时间:
      $$
        T_\text{scan}=2\pi/\Omega(T_{ND1}+T_{ND2}+T_{ND3})= 44.18\text{ (ms)}
      $$
    而网络维持阶段每1000ms中通信业务最大可用时隙长度仅为100ms,若采用固定帧结构，则面临链路发现时间和数据速率之间的权衡。

4. 组网策略
   
   未入网节点完成网络扫描

## 2019-10-28 南京724所会议纪要

1. "分组投递率90%"指无重传情况下包的送达率
2. 8个窄带接收波束带宽为10MHz,1个宽带接收波束带宽为100MHz
3. 最大通信距离为30km
4. 发射信号最大占空比为50%
5. 电路板目前只能提供一套，年底前视项目进度可再提供一套
6. 验收时只测试一个阵面，2个节点
7. 相控阵发射功率为0.5W × 512